{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card slide-in">
            <div class="card-header text-center">
                <div class="mb-3">
                    <i class="fas fa-qrcode" style="font-size: 3rem; color: white;"></i>
                </div>
                <h4 class="card-title mb-0">Generate QR Code</h4>
                <p class="text-white-50 mb-0">for {{ subject.name }}</p>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-4">
                                <label for="class_start_time" class="form-label">
                                    <i class="fas fa-clock me-2"></i>Class Start Time
                                </label>
                                <input type="datetime-local" class="form-control form-control-lg" 
                                       id="class_start_time" name="class_start_time" required>
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>Select the start time of your class
                                </small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-4">
                                <label for="class_end_time" class="form-label">
                                    <i class="fas fa-clock me-2"></i>Class End Time
                                </label>
                                <input type="datetime-local" class="form-control form-control-lg" 
                                       id="class_end_time" name="class_end_time" required>
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>Select the end time of your class
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-4">
                                <label for="expiry_value" class="form-label">
                                    <i class="fas fa-hourglass-half me-2"></i>QR Expiry
                                </label>
                                <div class="input-group">
                                    <input type="number" min="1" step="1" class="form-control form-control-lg" id="expiry_value" name="expiry_value" value="{{ (qr_expiry_seconds // 60) if qr_expiry_seconds >= 60 else qr_expiry_seconds }}" required>
                                    <select id="expiry_unit" name="expiry_unit" class="form-select form-select-lg">
                                        <option value="seconds" {% if qr_expiry_seconds < 60 %}selected{% endif %}>Seconds</option>
                                        <option value="minutes" {% if qr_expiry_seconds >= 60 %}selected{% endif %}>Minutes</option>
                                    </select>
                                </div>
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>How long the QR remains valid after generation
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-info-circle me-3 mt-1" style="font-size: 1.2rem;"></i>
                            <div>
                                <strong>Important Note:</strong><br>
                                The QR code will be valid for <strong>{{ qr_expiry_seconds }} seconds</strong> (or your chosen value) after generation.
                                Students must scan it within this time to mark their attendance.
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-3">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-qrcode me-2"></i>Generate QR Code
                        </button>
                        <a href="{{ url_for('teacher.dashboard') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Set default values to current time and 1 hour later
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);
    
    // Format for datetime-local input
    const formatDateTime = (date) => {
        return date.toISOString().slice(0, 16);
    };
    
    document.getElementById('class_start_time').value = formatDateTime(now);
    document.getElementById('class_end_time').value = formatDateTime(oneHourLater);
});
</script>
{% endblock %} 